{"version":3,"sources":["../src/lib/openai-adapter.ts"],"sourcesContent":["import OpenAI from \"openai\";\nimport { CopilotKitServiceAdapter } from \"../types/service-adapter\";\nimport { limitOpenAIMessagesToTokenCount, maxTokensForOpenAIModel } from \"../utils/openai\";\n\nconst DEFAULT_MODEL = \"gpt-4-1106-preview\";\n\nexport interface OpenAIAdapterParams {\n  openai?: OpenAI;\n  model?: string;\n}\n\nexport class OpenAIAdapter implements CopilotKitServiceAdapter {\n  private openai: OpenAI;\n  private model: string = DEFAULT_MODEL;\n  constructor(params?: OpenAIAdapterParams) {\n    this.openai = params?.openai || new OpenAI({});\n    if (params?.model) {\n      this.model = params.model;\n    }\n  }\n\n  stream(forwardedProps: any): ReadableStream {\n    // copy forwardedProps to avoid modifying the original object\n    forwardedProps = { ...forwardedProps };\n\n    // Remove tools if there are none to avoid OpenAI API errors\n    // when sending an empty array of tools\n    if (forwardedProps.tools && forwardedProps.tools.length === 0) {\n      delete forwardedProps.tools;\n    }\n\n    const messages = limitOpenAIMessagesToTokenCount(\n      forwardedProps.messages || [],\n      forwardedProps.tools || [],\n      maxTokensForOpenAIModel(forwardedProps.model || DEFAULT_MODEL),\n    );\n\n    return this.openai.beta.chat.completions\n      .stream({\n        model: this.model,\n        ...forwardedProps,\n        stream: true,\n        messages: messages as any,\n      })\n      .toReadableStream();\n  }\n}\n"],"mappings":";;;;;;AAAA,OAAO,YAAY;AAInB,IAAM,gBAAgB;AAOf,IAAM,gBAAN,MAAwD;AAAA,EAG7D,YAAY,QAA8B;AAD1C,SAAQ,QAAgB;AAEtB,SAAK,UAAS,iCAAQ,WAAU,IAAI,OAAO,CAAC,CAAC;AAC7C,QAAI,iCAAQ,OAAO;AACjB,WAAK,QAAQ,OAAO;AAAA,IACtB;AAAA,EACF;AAAA,EAEA,OAAO,gBAAqC;AAE1C,qBAAiB,EAAE,GAAG,eAAe;AAIrC,QAAI,eAAe,SAAS,eAAe,MAAM,WAAW,GAAG;AAC7D,aAAO,eAAe;AAAA,IACxB;AAEA,UAAM,WAAW;AAAA,MACf,eAAe,YAAY,CAAC;AAAA,MAC5B,eAAe,SAAS,CAAC;AAAA,MACzB,wBAAwB,eAAe,SAAS,aAAa;AAAA,IAC/D;AAEA,WAAO,KAAK,OAAO,KAAK,KAAK,YAC1B,OAAO;AAAA,MACN,OAAO,KAAK;AAAA,MACZ,GAAG;AAAA,MACH,QAAQ;AAAA,MACR;AAAA,IACF,CAAC,EACA,iBAAiB;AAAA,EACtB;AACF;","names":[]}